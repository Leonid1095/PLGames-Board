# üîç PLGames Board - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –∞—É–¥–∏—Ç DI

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Å–∏—Å—Ç–µ–º—É –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Å–µ—Ö Dependency Injection –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –≤ –ø—Ä–æ–µ–∫—Ç–µ.

## –ü—Ä–æ–±–ª–µ–º—ã –∫–æ—Ç–æ—Ä—ã–µ –º—ã —Ä–µ—à–∏–ª–∏

### 1. **Type-Only Imports –≤ –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞—Ö**
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ —Å–µ—Ä–≤–∏—Å–∞ –∫–∞–∫ `import type { Service }` TypeScript —Å—Ç–∏—Ä–∞–µ—Ç —ç—Ç–æ—Ç –∏–º–ø–æ—Ä—Ç –ø—Ä–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏, –∏ Nest –≤–∏–¥–∏—Ç —ç—Ç–æ –∫–∞–∫ `Object`.

**–†–µ—à–µ–Ω–∏–µ:** –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã/–ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞—Ö –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å value-–∏–º–ø–æ—Ä—Ç–∞–º–∏:
```typescript
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
import type { PermissionService } from '../permission';

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û:
import { PermissionService } from '../permission';
```

### 2. **–ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã –ù–µ –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è**
**–ü—Ä–æ–±–ª–µ–º–∞:** `PrismaModule` - –≥–ª–æ–±–∞–ª—å–Ω—ã–π, –Ω–æ –µ—Å–ª–∏ –º–æ–¥—É–ª—å –Ω–µ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –µ–≥–æ, –ø—Ä–æ–≤–∞–π–¥–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.

**–†–µ—à–µ–Ω–∏–µ:** `PrismaModule` –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ `@Global()`, –¥–æ—Å—Ç—É–ø–µ–Ω –≤–µ–∑–¥–µ. –ù–æ –∫–∞–∂–¥—ã–π –º–æ–¥—É–ª—å –î–û–õ–ñ–ï–ù —è–≤–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å `PrismaModule` –≤ —Å–≤–æ–∏ `imports`.

### 3. **–ú–æ–¥—É–ª—å–Ω—ã–µ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ù–µ –£–∫–∞–∑–∞–Ω—ã**
**–ü—Ä–æ–±–ª–µ–º–∞:** `UserModule` –Ω–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–ª `PrismaModule`, —Ö–æ—Ç—è `UserManagementResolver` –Ω—É–∂–µ–Ω `PrismaClient`.

**–†–µ—à–µ–Ω–∏–µ:** –í—Å–µ –º–æ–¥—É–ª–∏ —Å resolvers/services, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–º–∏ external providers, –¥–æ–ª–∂–Ω—ã –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω—É–∂–Ω—ã–µ –º–æ–¥—É–ª–∏:
```typescript
@Module({
  imports: [PrismaModule, PermissionModule, StorageModule],
  providers: [...],
})
```

---

## –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è –ê—É–¥–∏—Ç–∞

### –î–ª—è –∫–∞–∂–¥–æ–≥–æ `*.resolver.ts` —Ñ–∞–π–ª–∞:

- [ ] –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ - value-–∏–º–ø–æ—Ä—Ç—ã (–Ω–µ type-only)
- [ ] –í—Å–µ –∏–Ω—ä–µ–∫—Ü–∏–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ä–µ–∞–ª—å–Ω–æ –æ–±—ä—è–≤–ª–µ–Ω–Ω—ã–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º
- [ ] –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `PrismaClient` - –∏–º–ø–æ—Ä—Ç `from '@prisma/client'` (value)
- [ ] –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `Models` - –∏–º–ø–æ—Ä—Ç –∏–∑ `'../../models'` (value)
- [ ] –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞—Å—Ç–æ–º–Ω—ã–π —Å–µ—Ä–≤–∏—Å - –æ–Ω —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –∏–∑ –º–æ–¥—É–ª—è

### –î–ª—è –∫–∞–∂–¥–æ–≥–æ `*.module.ts` —Ñ–∞–π–ª–∞:

- [ ] –í—Å–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã –≤ `imports:` —É–∫–∞–∑–∞–Ω—ã
- [ ] –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏ (`@Global()`) –ø—Ä–æ–ø–∏—Å–∞–Ω—ã –≤ `imports:` —è–≤–Ω–æ
- [ ] –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã–µ providers –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ç—Ä–∞–∂–∞—é—Ç —Ä–µ–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- [ ] –ù–µ—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏

---

## –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –∏ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ DI –û—à–∏–±–∫–∏

| –§–∞–π–ª | –ü—Ä–æ–±–ª–µ–º–∞ | –†–µ—à–µ–Ω–∏–µ | –ö–æ–º–º–∏—Ç |
|------|---------|---------|--------|
| `crm/crm.resolver.ts` (CrmIssueResolver) | `PrismaService` –≤–º–µ—Å—Ç–æ `PrismaClient` | –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ `PrismaClient from '@prisma/client'` | cf6fa6055 |
| `crm/crm.resolver.ts` (CrmSprintResolver, CrmCommentResolver, CrmTimeLogResolver) | `PrismaService` –≤–º–µ—Å—Ç–æ `PrismaClient` | –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ `PrismaClient from '@prisma/client'` | 402cf3a9e |
| `user/resolver.ts` | `PrismaClient` –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –∫–∞–∫ type-only | –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ value-–∏–º–ø–æ—Ä—Ç | d7824ab8a |
| `user/index.ts` | `PrismaModule` –Ω–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω | –î–æ–±–∞–≤–∏—Ç—å –≤ imports | be427c813 |

---

## –°–∫—Ä–∏–ø—Ç –î–ª—è –ü—Ä–æ–≤–µ—Ä–∫–∏ (build-time validation)

–í –±—É–¥—É—â–µ–º –¥–æ–±–∞–≤–∏–º —Å–∫—Ä–∏–ø—Ç –≤ `package.json`:

```json
{
  "scripts": {
    "validate:di": "node scripts/validate-di.js",
    "build": "yarn validate:di && yarn plgames build"
  }
}
```

–°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
1. –ù–µ—Ç type-only –∏–º–ø–æ—Ä—Ç–æ–≤ –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞—Ö
2. –í—Å–µ `@Injectable()` –∫–ª–∞—Å—Å—ã –∏–º–µ—é—Ç matching providers
3. –í—Å–µ –º–æ–¥—É–ª–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç –Ω—É–∂–Ω—ã–µ providers
4. –ù–µ—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

---

## –ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

### –ü—Ä–∏ –î–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ù–æ–≤–æ–≥–æ Resolver/Service:

1. **–û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
   ```typescript
   @Resolver(() => MyType)
   export class MyResolver {
     constructor(
       private readonly service: MyService,      // value-import
       private readonly models: Models,          // value-import
       private readonly prisma: PrismaClient     // value-import
     ) {}
   }
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–º–ø–æ—Ä—Ç—ã:**
   - `import { MyService } from '../my-service'` (NOT type)
   - `import { PrismaClient } from '@prisma/client'` (NOT type)
   - `import { Models } from '../../models'` (NOT type)

3. **–î–æ–±–∞–≤—å—Ç–µ –≤ –º–æ–¥—É–ª—å:**
   ```typescript
   @Module({
     imports: [PrismaModule, MyServiceModule],  // <- import the modules
     providers: [MyResolver],
     exports: [MyResolver],
   })
   export class MyModule {}
   ```

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–¥ –ø—É—à–µ–º:**
   ```bash
   yarn validate:di    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å DI –∫–æ–Ω—Ñ–∏–≥
   yarn typecheck      # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∏–ø—ã
   ```

---

## –ö–∞–∫ –†–∞–±–æ—Ç–∞–µ—Ç –ò–Ω—ä–µ–∫—Ü–∏—è –≤ NestJS

```
1. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç
   ‚Üì
2. NestJS –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤—Å–µ @Module() –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
   ‚Üì
3. –°–æ–±–∏—Ä–∞–µ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã –∏–∑ –≤—Å–µ—Ö imported –º–æ–¥—É–ª–µ–π
   ‚Üì
4. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∞—Å—Å–∞ —Å @Injectable() –∏–ª–∏ @Resolver():
   - –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç constructor –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
   - –ò—â–µ—Ç matching –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã –ø–æ —Ç–∏–ø—É
   - –°–æ–∑–¥–∞–µ—Ç –∏ –∏–Ω–∂–µ–∫—Ç–∏—Ä—É–µ—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä—ã
   ‚Üì
5. –ï—Å–ª–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí UnknownDependenciesException
```

**–ö–ª—é—á:** TypeScript –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –î–û–õ–ñ–ï–ù –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–∏–ø –≤ runtime –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö.
- `import type { X }` ‚Üí —Ç–∏–ø —Å—Ç–∏—Ä–∞–µ—Ç—Å—è ‚Üí runtime –≤–∏–¥–∏—Ç `Object`
- `import { X }` ‚Üí —Ç–∏–ø —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è ‚Üí runtime –≤–∏–¥–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–ª–∞—Å—Å

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ù–∞ –¢–µ–∫—É—â–µ–º –°–µ—Ä–≤–µ—Ä–µ

```bash
# –ü–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–∑—ã
docker compose down -v

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å backend —Å –Ω–æ–≤–µ–π—à–∏–º –∫–æ–¥–æ–º
docker compose build --no-cache backend

# –ó–∞–ø—É—Å—Ç–∏—Ç—å
docker compose up -d

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker compose logs -n 200 backend | grep -E "ERROR|Exception|Nest"
```

–ï—Å–ª–∏ –æ—à–∏–±–æ–∫ –Ω–µ—Ç ‚Üí —É—Å–ø–µ—Ö! üéâ

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- **NestJS DI Docs:** https://docs.nestjs.com/fundamentals/custom-providers
- **TypeScript Compiler Options:** https://www.typescriptlang.org/tsconfig
- **Module System:** https://docs.nestjs.com/modules
