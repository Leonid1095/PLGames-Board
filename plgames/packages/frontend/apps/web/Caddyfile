:80 {
    root * /usr/share/caddy
    encode gzip

    # Proxy API requests to backend BEFORE file_server
    # Using handle blocks to ensure proper routing order
    handle /api/* {
        reverse_proxy backend:3010
    }

    handle /graphql {
        reverse_proxy backend:3010
    }

    handle /socket.io/* {
        reverse_proxy backend:3010
    }

    # Handle all other requests - static files with SPA fallback
    handle {
        try_files {path} /index.html
        file_server
    }
}
