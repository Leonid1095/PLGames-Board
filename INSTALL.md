# PLGames Board - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ

–ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ PLGames Board –Ω–∞ Linux —Å–µ—Ä–≤–µ—Ä.

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)](#-–±—ã—Å—Ç—Ä–∞—è-—É—Å—Ç–∞–Ω–æ–≤–∫–∞)
2. [–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–∏—Å—Ç–µ–º–µ](#-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è-–∫-—Å–∏—Å—Ç–µ–º–µ)
3. [–†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞](#-—Ä—É—á–Ω–∞—è-—É—Å—Ç–∞–Ω–æ–≤–∫–∞-–ø–æ—à–∞–≥–æ–≤–æ)
4. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞](#-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
5. [–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã](#-–ø—Ä–æ–≤–µ—Ä–∫–∞-—Ä–∞–±–æ—Ç—ã)
6. [–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ](#-—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-—Å–∏—Å—Ç–µ–º–æ–π)
7. [–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º](#-—Ä–µ—à–µ–Ω–∏–µ-–ø—Ä–æ–±–ª–µ–º)

---

## üöÄ –ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (1 –∫–æ–º–∞–Ω–¥–∞):

```bash
curl -fsSL https://raw.githubusercontent.com/Leonid1095/boards_plane/main/install.sh | sudo bash
```

–ò–ª–∏ —á–µ—Ä–µ–∑ wget:
```bash
wget -qO- https://raw.githubusercontent.com/Leonid1095/boards_plane/main/install.sh | sudo bash
```

**–í—Ä–µ–º—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏:** 15-20 –º–∏–Ω—É—Ç

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç —Å–∏—Å—Ç–µ–º—É
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç Docker
- ‚úÖ –°–∫–∞—á–∞–µ—Ç –ø—Ä–æ–µ–∫—Ç
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (—Å–ø—Ä–æ—Å–∏—Ç –¥–æ–º–µ–Ω –∏ AI)
- ‚úÖ –°–æ–±–µ—Ä–µ—Ç –∏ –∑–∞–ø—É—Å—Ç–∏—Ç –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
- ‚úÖ –í—ã–ø–æ–ª–Ω–∏—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –∫ —Ä–∞–∑–¥–µ–ª—É [–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã](#-–ø—Ä–æ–≤–µ—Ä–∫–∞-—Ä–∞–±–æ—Ç—ã).

---

## üíª –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–∏—Å—Ç–µ–º–µ

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- **–û–°:** Ubuntu 20.04+ –∏–ª–∏ Debian 11+
- **CPU:** 2 —è–¥—Ä–∞
- **RAM:** 4 GB
- **–î–∏—Å–∫:** 20 GB —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞
- **–°–µ—Ç—å:** –ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É
- **–ü—Ä–∞–≤–∞:** root –∏–ª–∏ sudo –¥–æ—Å—Ç—É–ø

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- **–û–°:** Ubuntu 22.04 LTS
- **CPU:** 4 —è–¥—Ä–∞
- **RAM:** 8 GB
- **–î–∏—Å–∫:** 50 GB (SSD)
- **–î–æ–º–µ–Ω:** –°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º–µ–Ω —Å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º

### –û—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ—Ä—Ç—ã:
- **22** - SSH –¥–æ—Å—Ç—É–ø
- **80** - HTTP (–¥–ª—è Let's Encrypt)
- **443** - HTTPS
- **3010** - Backend API (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞)
- **8080** - Frontend (–µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è proxy)

---

## üîß –†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (–ø–æ—à–∞–≥–æ–≤–æ)

–ï—Å–ª–∏ –Ω–µ —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç, —Å–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –Ω–∏–∂–µ.

### –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

#### 1.1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É

```bash
ssh root@your-server-ip
# –∏–ª–∏
ssh your-user@your-server-ip
```

#### 1.2. –û–±–Ω–æ–≤–∏—Ç–µ —Å–∏—Å—Ç–µ–º—É

```bash
sudo apt-get update
sudo apt-get upgrade -y
```

#### 1.3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã

```bash
sudo apt-get install -y \
    git \
    curl \
    wget \
    openssl \
    ca-certificates \
    gnupg \
    lsb-release
```

### –®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker

#### 2.1. –£–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏ Docker (–µ—Å–ª–∏ –µ—Å—Ç—å)

```bash
sudo apt-get remove -y docker docker-engine docker.io containerd runc 2>/dev/null || true
```

#### 2.2. –î–æ–±–∞–≤—å—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π Docker

```bash
# –î–æ–±–∞–≤—å—Ç–µ GPG –∫–ª—é—á
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg

# –î–æ–±–∞–≤—å—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
```

**–î–ª—è –†–æ—Å—Å–∏–∏ (–µ—Å–ª–∏ –º–µ–¥–ª–µ–Ω–Ω–æ —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è):**
```bash
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∑–µ—Ä–∫–∞–ª–æ Yandex
curl -fsSL https://mirror.yandex.ru/mirrors/docker/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg

echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://mirror.yandex.ru/mirrors/docker/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
```

#### 2.3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Docker

```bash
sudo apt-get update
sudo apt-get install -y docker-ce docker-ce-cli containerd.io docker-compose-plugin
```

#### 2.4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ Docker

```bash
sudo systemctl start docker
sudo systemctl enable docker
```

#### 2.5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É

```bash
docker --version
# –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å: Docker version 24.x.x

docker compose version
# –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å: Docker Compose version v2.x.x
```

### –®–∞–≥ 3: –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∏ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

#### 3.1. –°–æ–∑–¥–∞–π—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞

```bash
sudo mkdir -p /opt/plgames
cd /opt/plgames
```

**–ü–æ—á–µ–º—É /opt/plgames?**
- `/opt/` - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –≤ Linux
- –í—Å–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞ –±—É–¥—É—Ç –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
- –õ–µ–≥–∫–æ –¥–µ–ª–∞—Ç—å backup –≤—Å–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

#### 3.2. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

```bash
sudo git clone --recurse-submodules https://github.com/Leonid1095/boards_plane.git .
```

**–í–∞–∂–Ω–æ:**
- –¢–æ—á–∫–∞ `.` –≤ –∫–æ–Ω—Ü–µ –æ–∑–Ω–∞—á–∞–µ—Ç "–∫–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –≤ —Ç–µ–∫—É—â—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é"
- `--recurse-submodules` –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω, –∏–Ω–∞—á–µ –Ω–µ —Å–∫–∞—á–∞–µ—Ç—Å—è –ø–æ–¥–º–æ–¥—É–ª—å `plgames/`

#### 3.3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Å–∫–∞—á–∞–ª–æ—Å—å

```bash
ls -la
```

–î–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ñ–∞–π–ª—ã:
- `docker-compose.yml`
- `install.sh`
- `.env.example`
- `README.md`
- `plgames/` (–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è)

### –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

#### 4.1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```bash
sudo cp .env.example .env
```

#### 4.2. –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ IP –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞

```bash
curl -4 ifconfig.me
# –ü–æ–∫–∞–∂–µ—Ç –≤–∞—à –≤–Ω–µ—à–Ω–∏–π IP, –Ω–∞–ø—Ä–∏–º–µ—Ä: 192.168.1.100
```

#### 4.3. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª

```bash
sudo nano .env
```

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**

```env
# –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
NODE_ENV=production
DOMAIN=your-domain.com          # –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à –¥–æ–º–µ–Ω –∏–ª–∏ IP
BASE_URL=https://your-domain.com # –ò–ª–∏ http://192.168.1.100

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (–æ—Å—Ç–∞–≤—å—Ç–µ –∫–∞–∫ –µ—Å—Ç—å –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å)
DB_USER=plgames
DB_PASSWORD=–∏–∑–º–µ–Ω–∏—Ç–µ_–Ω–∞_—Å–≤–æ–π_–ø–∞—Ä–æ–ª—å_–¥–ª–∏–Ω–Ω—ã–π_–∏_—Å–ª–æ–∂–Ω—ã–π
DB_NAME=plgames
```

**–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**

```env
# AI —á–µ—Ä–µ–∑ OpenRouter (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
AFFINE_COPILOT_ENABLED=true
AFFINE_COPILOT_OPENROUTER_API_KEY=sk-or-v1-–≤–∞—à_–∫–ª—é—á
AFFINE_COPILOT_OPENROUTER_MODEL=meta-llama/llama-3.1-70b-instruct

# OAuth —á–µ—Ä–µ–∑ Yandex (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
OIDC_CLIENT_ID=–≤–∞—à_client_id
OIDC_CLIENT_SECRET=–≤–∞—à_secret

# –ü–æ—Ä—Ç—ã (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å)
BACKEND_PORT=3010
FRONTEND_PORT=8080
POSTGRES_PORT=5432
```

**–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø–∞—Ä–æ–ª—è:**
```bash
openssl rand -base64 32 | tr -d "=+/" | cut -c1-25
```

#### 4.4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

```bash
sudo chmod 600 .env
```

–≠—Ç–æ –∑–∞—â–∏—Ç–∏—Ç —Ñ–∞–π–ª —Å –ø–∞—Ä–æ–ª—è–º–∏ –æ—Ç —á—Ç–µ–Ω–∏—è –¥—Ä—É–≥–∏–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏.

### –®–∞–≥ 5: –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫

#### 5.1. –°–æ–±–µ—Ä–∏—Ç–µ Docker –æ–±—Ä–∞–∑—ã

```bash
sudo docker compose build --no-cache
```

**–≠—Ç–æ –∑–∞–π–º–µ—Ç 15-20 –º–∏–Ω—É—Ç.** –ë—É–¥—É—Ç —Å–∫–∞—á–∞–Ω—ã –∏ —Å–æ–±—Ä–∞–Ω—ã:
- Backend (NestJS)
- Frontend (React + Caddy)
- PostgreSQL —Å pgvector
- Redis

#### 5.2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã

```bash
sudo docker compose up -d
```

–§–ª–∞–≥ `-d` –æ–∑–Ω–∞—á–∞–µ—Ç "–≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ".

#### 5.3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å

```bash
sudo docker compose ps
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
NAME                          STATUS              PORTS
plgames-backend-1             Up (healthy)        0.0.0.0:3010->3010/tcp
plgames-frontend-1            Up                  0.0.0.0:8080->80/tcp
plgames-postgres-1            Up (healthy)        5432/tcp
plgames-redis-1               Up                  6379/tcp
```

–í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ —Å—Ç–∞—Ç—É—Å–µ `Up`.

### –®–∞–≥ 6: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

#### 6.1. –î–æ–∂–¥–∏—Ç–µ—Å—å –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ PostgreSQL

```bash
# –ü–æ–¥–æ–∂–¥–∏—Ç–µ 30 —Å–µ–∫—É–Ω–¥ –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
sleep 30

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ PostgreSQL –≥–æ—Ç–æ–≤
sudo docker compose exec postgres pg_isready -U plgames
```

–î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å: `postgres:5432 - accepting connections`

#### 6.2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
sudo docker compose exec backend sh -c "npx prisma migrate deploy"
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚úì Applying migration `20241201_initial_crm`
‚úì Applying migration `20241201_add_crm_tables`
‚úì All migrations have been successfully applied
```

**–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ "backend is not running":**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
sudo docker compose logs backend --tail=50

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ backend
sudo docker compose restart backend
sleep 10

# –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞
sudo docker compose exec backend sh -c "npx prisma migrate deploy"
```

### –®–∞–≥ 7: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

#### 7.1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏

```bash
# Backend –ª–æ–≥–∏
sudo docker compose logs backend --tail=30
```

**–î–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∞:**
```
[Nest] ... INFO [NestApplication] Nest application successfully started
```

#### 7.2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å

```bash
# Backend API
curl -I http://localhost:3010/graphql

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å HTTP/1.1 400 –∏–ª–∏ 200
```

```bash
# Frontend
curl -I http://localhost:8080

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å HTTP/1.1 200
```

#### 7.3. –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞:
- `http://–≤–∞—à-ip:8080` - Frontend
- `http://–≤–∞—à-ip:3010/graphql` - GraphQL Playground

**–ì–æ—Ç–æ–≤–æ!** PLGames Board —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç.

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ HTTPS (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

#### –í–∞—Ä–∏–∞–Ω—Ç 1: Caddy (–ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–±)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Caddy
sudo apt install -y debian-keyring debian-archive-keyring apt-transport-https
curl -1sLf 'https://dl.cloudsmith.io/public/caddy/stable/gpg.key' | sudo gpg --dearmor -o /usr/share/keyrings/caddy-stable-archive-keyring.gpg
curl -1sLf 'https://dl.cloudsmith.io/public/caddy/stable/debian.deb.txt' | sudo tee /etc/apt/sources.list.d/caddy-stable.list
sudo apt update
sudo apt install caddy

# –°–æ–∑–¥–∞–π—Ç–µ Caddyfile
sudo nano /etc/caddy/Caddyfile
```

**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:**
```
your-domain.com {
    reverse_proxy localhost:8080
}

api.your-domain.com {
    reverse_proxy localhost:3010
}
```

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Caddy
sudo systemctl restart caddy
```

#### –í–∞—Ä–∏–∞–Ω—Ç 2: Nginx + Let's Encrypt

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Nginx –∏ Certbot
sudo apt install -y nginx certbot python3-certbot-nginx

# –°–æ–∑–¥–∞–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥
sudo nano /etc/nginx/sites-available/plgames
```

**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:**
```nginx
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://localhost:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}

server {
    listen 80;
    server_name api.your-domain.com;

    location / {
        proxy_pass http://localhost:3010;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

```bash
# –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥
sudo ln -s /etc/nginx/sites-available/plgames /etc/nginx/sites-enabled/

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥
sudo nginx -t

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Nginx
sudo systemctl restart nginx

# –ü–æ–ª—É—á–∏—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
sudo certbot --nginx -d your-domain.com -d api.your-domain.com
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ AI (OpenRouter)

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ https://openrouter.ai/
2. –°–æ–∑–¥–∞–π—Ç–µ API –∫–ª—é—á
3. –î–æ–±–∞–≤—å—Ç–µ –≤ `.env`:
```env
AFFINE_COPILOT_ENABLED=true
AFFINE_COPILOT_OPENROUTER_API_KEY=sk-or-v1-–≤–∞—à_–∫–ª—é—á
```
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ backend:
```bash
sudo docker compose restart backend
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ OAuth (Yandex)

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://oauth.yandex.ru/client/new
2. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
   - –ù–∞–∑–≤–∞–Ω–∏–µ: PLGames Board
   - Redirect URI: `https://–≤–∞—à-–¥–æ–º–µ–Ω.com/oauth/callback`
   - –ü—Ä–∞–≤–∞: `login:email`, `login:info`
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ Client ID –∏ Client Secret
4. –î–æ–±–∞–≤—å—Ç–µ –≤ `.env`:
```env
OIDC_CLIENT_ID=–≤–∞—à_client_id
OIDC_CLIENT_SECRET=–≤–∞—à_secret
```
5. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ backend

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

```bash
sudo docker compose ps
```

–í—Å–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å `Up`.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

```bash
# –í—Å–µ –ª–æ–≥–∏
sudo docker compose logs -f

# –¢–æ–ª—å–∫–æ backend
sudo docker compose logs -f backend

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Å—Ç—Ä–æ–∫
sudo docker compose logs backend --tail=50
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ PostgreSQL
sudo docker compose exec postgres psql -U plgames -d plgames

# –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–ø—Ä–æ—Å
SELECT COUNT(*) FROM "User";

# –í—ã–π–¥–∏—Ç–µ
\q
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ API

```bash
# GraphQL –¥–æ—Å—Ç—É–ø–µ–Ω
curl http://localhost:3010/graphql

# Health check
curl http://localhost:3010/api/healthz
```

---

## üõ†Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–æ–π

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤
sudo docker compose ps

# –õ–æ–≥–∏ (–≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã)
sudo docker compose logs -f

# –õ–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
sudo docker compose logs -f backend
sudo docker compose logs -f frontend
sudo docker compose logs -f postgres

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
sudo docker compose restart

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
sudo docker compose restart backend

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
sudo docker compose down

# –ó–∞–ø—É—Å–∫ –ø–æ—Å–ª–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
sudo docker compose up -d

# –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
sudo docker stats
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

```bash
cd /opt/plgames

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
sudo docker compose down

# –°–∫–∞—á–∞–π—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
sudo git pull

# –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞–∑—ã
sudo docker compose build --no-cache

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ
sudo docker compose up -d

# –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)
sudo docker compose exec backend sh -c "npx prisma migrate deploy"
```

### –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

#### Backup –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# –°–æ–∑–¥–∞–π—Ç–µ backup
sudo docker compose exec postgres pg_dump -U plgames plgames > backup_$(date +%Y%m%d_%H%M%S).sql

# –ò–ª–∏ —Å –∞—Ä—Ö–∏–≤–∞—Ü–∏–µ–π
sudo docker compose exec postgres pg_dump -U plgames plgames | gzip > backup_$(date +%Y%m%d_%H%M%S).sql.gz
```

#### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ backup

```bash
# –ò–∑ –æ–±—ã—á–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
cat backup_20241202_120000.sql | sudo docker compose exec -T postgres psql -U plgames -d plgames

# –ò–∑ –∞—Ä—Ö–∏–≤–∞
gunzip -c backup_20241202_120000.sql.gz | sudo docker compose exec -T postgres psql -U plgames -d plgames
```

#### Backup —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞

```bash
# Backup –≤—Å–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
sudo tar -czf plgames_backup_$(date +%Y%m%d).tar.gz /opt/plgames

# Backup —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã—Ö (volumes)
sudo docker run --rm -v plgames_postgres_data:/data -v $(pwd):/backup ubuntu tar czf /backup/postgres_data_$(date +%Y%m%d).tar.gz /data
```

### –û—á–∏—Å—Ç–∫–∞ —Å–∏—Å—Ç–µ–º—ã

```bash
# –£–¥–∞–ª–∏—Ç–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –æ–±—Ä–∞–∑—ã –∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
sudo docker system prune -a

# –£–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—ã–µ –ª–æ–≥–∏
sudo docker compose logs --tail=0 backend
sudo docker compose logs --tail=0 frontend

# –û—á–∏—Å—Ç–∏—Ç–µ –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ
sudo apt-get clean
sudo apt-get autoremove -y
```

---

## üö® –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### Backend –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º—ã:**
- `docker compose ps` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç `Restarting` –∏–ª–∏ `Exited`
- –°–∞–π—Ç –æ—Ç–¥–∞–µ—Ç 502 Bad Gateway

**–†–µ—à–µ–Ω–∏–µ:**

1. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏:
```bash
sudo docker compose logs backend --tail=100
```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ PostgreSQL –≥–æ—Ç–æ–≤:
```bash
sudo docker compose exec postgres pg_isready -U plgames
```

3. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ backend:
```bash
sudo docker compose down
sudo docker compose build --no-cache backend
sudo docker compose up -d
```

4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏:
```bash
sudo docker compose exec backend sh -c "npx prisma migrate deploy"
```

### Frontend –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º—ã:**
- `curl http://localhost:8080` –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å:
```bash
sudo docker compose ps frontend
```

2. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏:
```bash
sudo docker compose logs frontend
```

3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ:
```bash
sudo docker compose restart frontend
```

### –û—à–∏–±–∫–∏ –º–∏–≥—Ä–∞—Ü–∏–π

**–°–∏–º–ø—Ç–æ–º—ã:**
- `Error: P3009: migrate found failed migrations`

**–†–µ—à–µ–Ω–∏–µ:**

1. –°–±—Ä–æ—Å—å—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏:
```bash
sudo docker compose exec backend sh -c "npx prisma migrate reset --force"
```

2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–Ω–æ–≤–æ:
```bash
sudo docker compose exec backend sh -c "npx prisma migrate deploy"
```

**‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï:** `migrate reset` —É–¥–∞–ª–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ!

### –ù–µ—Ç –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ

**–°–∏–º–ø—Ç–æ–º—ã:**
- –û—à–∏–±–∫–∏ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ –æ–±—Ä–∞–∑–æ–≤
- `no space left on device`

**–†–µ—à–µ–Ω–∏–µ:**

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
```bash
df -h
```

2. –£–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–∑—ã:
```bash
sudo docker system prune -a
```

3. –£–¥–∞–ª–∏—Ç–µ –ª–æ–≥–∏:
```bash
sudo journalctl --vacuum-time=3d
```

4. –û—á–∏—Å—Ç–∏—Ç–µ apt:
```bash
sudo apt-get clean
sudo apt-get autoremove -y
```

### PostgreSQL –Ω–µ –≥–æ—Ç–æ–≤

**–°–∏–º–ø—Ç–æ–º—ã:**
- Backend –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –±–∞–∑–µ
- `connection refused` –≤ –ª–æ–≥–∞—Ö

**–†–µ—à–µ–Ω–∏–µ:**

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å PostgreSQL:
```bash
sudo docker compose ps postgres
sudo docker compose logs postgres
```

2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ:
```bash
sudo docker compose restart postgres
sleep 30
sudo docker compose restart backend
```

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `.env`:
```bash
grep DB_ .env
```

### –ú–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞

**–ü—Ä–∏—á–∏–Ω—ã:**
- –ú–∞–ª–æ RAM (< 4GB)
- –ú–µ–¥–ª–µ–Ω–Ω—ã–π –¥–∏—Å–∫ (HDD –≤–º–µ—Å—Ç–æ SSD)
- –ú–Ω–æ–≥–æ –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

**–†–µ—à–µ–Ω–∏–µ:**

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤:
```bash
sudo docker stats
```

2. –£–≤–µ–ª–∏—á—å—Ç–µ RAM –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞

3. –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ Redis:
```bash
# –í .env –¥–æ–±–∞–≤—å—Ç–µ
REDIS_MAXMEMORY=256mb
REDIS_MAXMEMORY_POLICY=allkeys-lru
```

4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∏—Å—Ç–µ–º—É

---

## üìû –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø–æ–º–æ—â—å

### –°–±–æ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–ª—è –æ—Ç—á–µ—Ç–∞ –æ–± –æ—à–∏–±–∫–µ

```bash
cd /opt/plgames

# –í–µ—Ä—Å–∏–∏
echo "=== Docker Version ===" > debug_info.txt
docker --version >> debug_info.txt
docker compose version >> debug_info.txt

# –°—Ç–∞—Ç—É—Å
echo "=== Container Status ===" >> debug_info.txt
docker compose ps >> debug_info.txt

# –õ–æ–≥–∏
echo "=== Backend Logs ===" >> debug_info.txt
docker compose logs backend --tail=100 >> debug_info.txt

echo "=== Frontend Logs ===" >> debug_info.txt
docker compose logs frontend --tail=50 >> debug_info.txt

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–ë–ï–ó –ü–ê–†–û–õ–ï–ô!)
echo "=== Environment ===" >> debug_info.txt
grep -v PASSWORD .env >> debug_info.txt

# –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–∞–π–ª debug_info.txt
```

### –°—Å—ã–ª–∫–∏

- **GitHub:** https://github.com/Leonid1095/boards_plane
- **Issues:** https://github.com/Leonid1095/boards_plane/issues
- **CHANGELOG:** [CHANGELOG.md](CHANGELOG.md)
- **Roadmap:** [ROADMAP.md](ROADMAP.md)

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2024-12-02
**–í–µ—Ä—Å–∏—è:** 1.1.0
